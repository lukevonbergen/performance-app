<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Performance Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="supabase.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex items-center justify-center">
        <div class="max-w-md w-full bg-white rounded-lg shadow-lg">
            <!-- Tabs -->
            <div class="flex border-b">
                <button onclick="switchTab('venue')" 
                        id="venueTab"
                        class="flex-1 py-4 px-6 text-center border-b-2 border-blue-500 text-blue-500 font-medium">
                    Venue Sign Up
                </button>
                <button onclick="switchTab('performer')" 
                        id="performerTab"
                        class="flex-1 py-4 px-6 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                    Performer Sign Up
                </button>
            </div>

            <!-- Form Container -->
            <div class="p-8">
                <h2 class="text-2xl font-bold text-center mb-6" id="formTitle">Sign Up Your Venue</h2>
                
                <form id="signupForm" class="space-y-4">
                    <input type="hidden" id="userType" value="venue">

                    <!-- Common fields -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">First Name</label>
                        <input type="text" id="firstName" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Last Name</label>
                        <input type="text" id="lastName" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>

                    <!-- Venue Fields -->
                    <div id="venueFields">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Venue Name</label>
                            <input type="text" id="venueName" required
                                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <!-- Performer Fields -->
                    <div id="performerFields" style="display: none;">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Genre</label>
                            <select id="genre" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                                <option value="">Select a genre</option>
                                <option value="rock">Rock</option>
                                <option value="jazz">Jazz</option>
                                <option value="pop">Pop</option>
                                <option value="classical">Classical</option>
                                <option value="electronic">Electronic</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Bio</label>
                            <textarea id="bio" rows="3" required
                                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
                                placeholder="Tell us about yourself and your performances..."></textarea>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="email" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="password" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                        <p class="mt-1 text-xs text-gray-500">Password must be at least 8 characters long</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Confirm Password</label>
                        <input type="password" id="confirmPassword" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>

                    <div id="passwordError" class="text-red-500 text-sm hidden">
                        Passwords do not match
                    </div>

                    <button type="submit"
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                        Sign Up
                    </button>
                </form>

                <div class="mt-4 text-center text-sm">
                    <a href="login.html" class="text-blue-600 hover:text-blue-700">Already have an account? Log in</a>
                </div>

                <div id="message" class="mt-4 text-center hidden"></div>
            </div>
        </div>
    </div>

    <script>
        function switchTab(type) {
            const venueTab = document.getElementById('venueTab');
            const performerTab = document.getElementById('performerTab');
            const venueFields = document.getElementById('venueFields');
            const performerFields = document.getElementById('performerFields');
            const userType = document.getElementById('userType');
            const formTitle = document.getElementById('formTitle');

            if (type === 'venue') {
                formTitle.textContent = 'Sign Up Your Venue';
                venueTab.classList.add('border-blue-500', 'text-blue-500');
                venueTab.classList.remove('border-transparent', 'text-gray-500');
                performerTab.classList.remove('border-blue-500', 'text-blue-500');
                performerTab.classList.add('border-transparent', 'text-gray-500');
                venueFields.style.display = 'block';
                performerFields.style.display = 'none';
            } else {
                formTitle.textContent = 'Sign Up as Performer';
                performerTab.classList.add('border-blue-500', 'text-blue-500');
                performerTab.classList.remove('border-transparent', 'text-gray-500');
                venueTab.classList.remove('border-blue-500', 'text-blue-500');
                venueTab.classList.add('border-transparent', 'text-gray-500');
                venueFields.style.display = 'none';
                performerFields.style.display = 'block';
            }

            userType.value = type;
        }
    </script>

    <script type="module">
        import { supabase } from './supabase.js';

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const messageDiv = document.getElementById('message');
            const passwordError = document.getElementById('passwordError');
            const userType = document.getElementById('userType').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Reset error messages
            messageDiv.className = 'mt-4 text-center hidden';
            passwordError.className = 'text-red-500 text-sm hidden';
            
            // Validate password
            if (password.length < 8) {
                messageDiv.textContent = 'Password must be at least 8 characters long';
                messageDiv.className = 'mt-4 text-center text-red-600';
                return;
            }

            // Check if passwords match
            if (password !== confirmPassword) {
                passwordError.className = 'text-red-500 text-sm';
                return;
            }
            
            try {
                const userData = {
                    first_name: document.getElementById('firstName').value,
                    last_name: document.getElementById('lastName').value,
                    email: document.getElementById('email').value,
                    password: password,
                    user_type: userType,
                    created_at: new Date().toISOString()
                };

                // Add type-specific fields
                if (userType === 'venue') {
                    userData.venue_name = document.getElementById('venueName').value;
                } else {
                    userData.genre = document.getElementById('genre').value;
                    userData.bio = document.getElementById('bio').value;
                }

                const { data, error } = await supabase
                    .from('PerformanceApp')
                    .insert([userData]);

                if (error) throw error;

                messageDiv.className = 'mt-4 text-center text-green-600';
                messageDiv.textContent = 'Sign up successful! Redirecting to login...';
                
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1000);
                
            } catch (error) {
                console.error('Error:', error);
                messageDiv.textContent = 'Error signing up. Please try again.';
                messageDiv.className = 'mt-4 text-center text-red-600';
            }
        });

        // Real-time password validation
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;
            const passwordError = document.getElementById('passwordError');
            
            if (password !== confirmPassword) {
                passwordError.className = 'text-red-500 text-sm';
            } else {
                passwordError.className = 'text-red-500 text-sm hidden';
            }
        });
    </script>
</body>
</html>
